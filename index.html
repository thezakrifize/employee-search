
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ระบบค้นหาข้อมูลพนักงาน ศจ.</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #2c3e50;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        button {
            background-color: #007BFF;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #007BFF;
            color: white;
        }
        .action-btn {
            margin: 0 4px;
        }
    </style>
</head>
<body>
    <h1>ระบบค้นหาข้อมูลพนักงาน ศจ.</h1>
    <input type="text" id="searchInput" placeholder="ค้นหาโดย รหัส / Initial / ชื่อ / ชื่อเล่น" oninput="renderTable()">
    <table id="resultsTable">
        <thead>
            <tr>
                <th>Initial</th>
                <th>ชื่อ</th>
                <th>นามสกุล</th>
                <th>ชื่อเล่น</th>
                <th>รหัสพนักงาน</th>
                <th>สังกัด</th>
                <th>เบอร์โทรศัพท์</th>
                <th>จัดการ</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyIbnlXutyXLjOwt1xzk04qanX5uYB1ef7uqhUz_21VR6tpUQY39Vq-ddRz_yfrWLMF/exec";
let employeeData = [];

async function fetchEmployees() {
    const res = await fetch(API_URL);
    employeeData = await res.json();
    renderTable();
}

function renderTable() {
    const keyword = document.getElementById('searchInput').value.toLowerCase();
    const tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = "";

    const filtered = employeeData.filter(emp =>
        emp.employee_id.toString().includes(keyword) ||
        emp.initial.toLowerCase().includes(keyword) ||
        emp.first_name.toLowerCase().includes(keyword) ||
        emp.nickname.toLowerCase().includes(keyword)
    );

    const sorted = filtered.sort((a, b) => a.initial.localeCompare(b.initial));
    sorted.forEach(emp => {
        const row = tbody.insertRow();
        row.innerHTML = `
            <td>${emp.initial}</td>
            <td contenteditable="false">${emp.first_name}</td>
            <td contenteditable="false">${emp.last_name}</td>
            <td contenteditable="false">${emp.nickname}</td>
            <td>${emp.employee_id}</td>
            <td contenteditable="false">${emp.department}</td>
            <td contenteditable="false">${emp.phone}</td>
            <td>
                <button class="action-btn" onclick="editRow(this)">แก้ไข</button>
                <button class="action-btn" onclick="deleteRow(this)">ลบ</button>
            </td>
        `;
    });
}

function editRow(btn) {
    const password = prompt("กรอกรหัสผ่านเพื่อแก้ไขข้อมูล:");
    if (password !== "BACCstaff") return alert("รหัสผ่านไม่ถูกต้อง");

    const cells = btn.closest("tr").querySelectorAll("td");
    for (let i = 1; i <= 6; i++) cells[i].setAttribute("contenteditable", "true");

    btn.innerText = "บันทึก";
    btn.onclick = async function () {
        for (let i = 1; i <= 6; i++) cells[i].setAttribute("contenteditable", "false");

        const updatedData = {
            initial: cells[0].innerText.trim(),
            first_name: cells[1].innerText.trim(),
            last_name: cells[2].innerText.trim(),
            nickname: cells[3].innerText.trim(),
            employee_id: cells[4].innerText.trim(),
            department: cells[5].innerText.trim(),
            phone: cells[6].innerText.trim()
        };

        await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({
                password: "BACCstaff",
                action: "update",
                data: updatedData
            }),
            headers: { "Content-Type": "application/json" }
        });

        alert("แก้ไขข้อมูลสำเร็จ");
        fetchEmployees();
    };
}

function deleteRow(btn) {
    const password = prompt("กรอกรหัสผ่านเพื่อลบข้อมูล:");
    if (password !== "BACCstaff") return alert("รหัสผ่านไม่ถูกต้อง");

    if (confirm("คุณแน่ใจว่าต้องการลบข้อมูลนี้?")) {
        const cells = btn.closest("tr").querySelectorAll("td");
        const id = cells[4].innerText.trim();

        fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({
                password: "BACCstaff",
                action: "delete",
                data: { employee_id: id }
            }),
            headers: { "Content-Type": "application/json" }
        }).then(() => {
            alert("ลบข้อมูลสำเร็จ");
            fetchEmployees();
        });
    }
}

fetchEmployees();
</script>
</body>
</html>
